[GENERAL]   
description   = D. melanogaster (FlyBase release R5.4; Nov 2007)
db_adaptor    = Bio::DB::SeqFeature::Store
db_args       = -adaptor DBI::mysql
                -dsn     fly
#db_adapter    = Bio::DB::GFF
#db_args       = -dsn dbi:mysql:fly2;user=nobody


#aggregators = processed_transcript

# Web site configuration info
gbrowse_root = gbrowse
stylesheet  = /css/gbrowse.css
buttons     = images/buttons
js          = js
tmpimages   = tmp
balloon images = /images/balloons

balloon tips        = 1
drag and drop       = 1
titles are balloons = 1
cache time          = 1  # one hour

plugins     = GFFDumper FastaDumper BatchDumper

quicklink plugins = GFFDumper FastaDumper

# list of tracks to turn on by default
default features = Genes ETILE1 ESTB 

# The class of the objects used to establish the reference coordinates.
reference class  =

# examples to show in the introduction
examples = 

search attributes = Note

# "automatic" classes to try when an unqualified identifier is given
automatic classes = CDS

#image_padding = 60
pad_left   = 25
pad_right  = 25

head   =  <script type="text/javascript" src="/js/modencode.js"></script>

init_code = use CGI ':standard';
            sub embed_browser {param('embedded')}
            sub get_url {url()}
            sub get_location {
              return param('name') if param('name');
              return param('ref') .':'. param('start') ."..". param('end') if param('ref');
	      return '';
            }
	    sub transfrag_citation {
             'This track shows the location of sites showing transcription over the first 24 hours of <i>D. melanogaster</i> development '.
             'in two hour increments, measured by a tiling array as described in <a href="http://www.ncbi.nlm.nih.gov/entrez/query.fcgi?db='.
	     'pubmed&cmd=Retrieve&dopt=AbstractPlus&list_uids=16951679&query_hl=1&itool=pubmed_docsum" target="_new">'.
	     'Manak JR, et al. Nature Genet. 2006 Oct;38(10):1151-8.</a> '.
	     'Fragments are shown in separate tracks for each of the twelve timepoints. '. 
             'See the <a href="http://genome.ucsc.edu/cgi-bin/hgTrackUi?hgsid=99411936&c=chr2L&g=affyDrosDevTransfrags" target="_new">'.
             'UCSC Genome Browser site for a more detailed description</a>.'; 
            }
	    sub signal_citation {
	     'This track shows an estimate of RNA abundance (transcription) over the first 24 hours of <i>D. melanogaster</i> development in '.
             'in two hour increments, measured by a tiling array as described in <a href="http://www.ncbi.nlm.nih.gov/entrez/query.fcgi?db='.
             'pubmed&cmd=Retrieve&dopt=AbstractPlus&list_uids=16951679&query_hl=1&itool=pubmed_docsum" target="_new">'.
             'Manak JR, et al. Nature Genet. 2006 Oct;38(10):1151-8.</a> '.
             'Composite signals are shown in separate tracks for each of the twelve timepoints. '.
	     'See the <a href="http://genome.ucsc.edu/cgi-bin/hgTrackUi?hgsid=99411936&c=chr2L&g=affyDrosDevSignal" target="_new">'.
             'UCSC Genome Browser site for a more detailed description</a>.';
            }


header = sub {
       my $embed = embed_browser();
       my $name  = get_location();
       my $url   = get_url();
       my $retval =  q(<script type="text/javascript">balloon.maxWidth = 350</script>);
       my $logo = $embed ? '' : q(<td valign=top width=150><img src="http://www.modencode.org/img/tlogo_small.png" ).
                                q(width=100 alt="logo" border=0 alt="modENCODE logo"/></td>);
       $retval .= q(<table width=100%><tr>).
                  $logo.
                  q(<td valign=top align=center>).
 		  q(<h1><img src="/img/fly_shadow.png" style="vertical-align:middle">&nbsp;<i>D. melanogaster</i> Genome Browser</h1> ).
                  q(</td></tr></table>);
       if ($embed) {
         $retval .= qq(<a class=header href="$url?name=$name" target="_new").
                    q(onmouseover="balloon.showTooltip(event,'Run the genome browser in a new window')">).
                    q([Expand Genome Browser]</a>&nbsp;).
                    q(<a class=header href="http://www.modencode.org/karyotypes.html" ).
                    q(onmouseover="balloon.showTooltip(event,'Go to the karyotype view to select a new chromosome or genome')">).
                    q([Whole Genome View]</a>&nbsp;).
                    q(<a class=header href="/cgi-bin/gbrowse/worm?embedded=1").
                   q(onmouseover="balloon.showTooltip(event,'Switch to the <i>C. elegans</i> genome browser')">).
                    q([Worm Browser]</a>&nbsp;);
     }
     else {
       $retval .= q(<br><a class=header href="http://www.modencode.org">[modENCODE home]</a>&nbsp;).
                  q(<a class=header href="/cgi-bin/gbrowse/worm").
                  q(onmouseover="balloon.showTooltip(event,'Switch to the <i>D. melanogaster</i> genome browser')">).
                  q([Worm Browser]</a>&nbsp;);
     }

     $retval .=  qq(<a class=header href="http://www.flybase.org/cgi-bin/gbrowse/dmel");
     $retval .=  $name ? qq(?name=$name" ) : q(" );
     $name = $name ? "this region ($name) in " : '';

     $retval .=  qq(onmouseover="balloon.showTooltip(event,'Browse ${name}FlyBase')">[Flybase]&nbsp;).
                 q(<a class=header href="mailto:help@modencode.org?subject=modENCODE Genome Browser (worm)").
                 q(onmouseover="balloon.showTooltip(event,'Get help or request new annotations/feature sets, etc.')">).
                 q([Help/Feedback]</a><br>);
     return $retval;
   }

# a footer
footer =
	<br><br>
        <table width="100%">
        <TR>
        <TD align="LEFT" class="databody">
        For the source code for this browser, see the <a href="http://www.gmod.org">
        Generic Model Organism Database Project.</a>  <br>For other questions, send
        mail to <a href="mailto:mckays@cshl.org">mckays@cshl.org</a>.
        </TD>
        </TR>
        </table>
        <hr>


# Various places where you can insert your own HTML -- see configuration docs
html1 = sub {if (embed_browser) {"<input type=hidden name='embedded' value='1'>"}}
html2 =
html3 =
html4 =
html5 =
html6 =

# what image widths to offer
image widths  = 450 500 600 640 800 1024

# default width of detailed view (pixels)
default width = 800

# max and default segment sizes for detailed view
max segment     = 5000000
default segment = 50000

# zoom levels
zoom levels    = 100 200 1000 2000 5000 10000 20000 50000 100000 200000 5000000 1000000

# colors of the overview, detailed map and key
overview bgcolor = lightgrey
detailed bgcolor = lightgoldenrodyellow
key bgcolor      = beige

########################
# Default glyph settings
########################

[TRACK DEFAULTS]
glyph         = generic
height        = 10
bgcolor       = lightgrey
fgcolor       = black
font2color    = blue
label density = 100
bump density  = 500
# where to link to when user clicks in detailed view
link          = AUTO
# general dense feature config
smoothing window = sub { my ($win) = sort {$b<=>$a} int($_[4]->panel->length/500), 50; $win }
smoothing        = sub { $_[4]->panel->length/100 > 200 ? 'max' : 'mean' }



################## TRACK CONFIGURATION ####################
# the remainder of the sections configure individual tracks
###########################################################

[Genes]
feature      = gene pseudogene
glyph        = gene
category     = Genes
height       = 8
bgcolor      = blue
label        = sub {
		my $f = shift;
		my $dn = $f->display_name;
		my @aliases = $f->each_tag_value('Alias');
		foreach (@aliases) {
		   return "$dn ($_)" if /^\w+-\d+/;
		}
		return $dn;
	}
description  = sub {
	my $f = shift;
	my @subf = eval{$f->get_SeqFeatures('mRNA')};
	my $note;
	for my $sf (@subf) {
	   $note ||= join '; ',$sf->each_tag_value('Note');
	}
        $note;
  }
link         = http://www.flybase.org/cgi-bin/uniq.html?species=Dmel&field=SYN&db=fbgn&context=$name&caller=quicksearch
label_transcripts =  1
das category = transcription
key          = FlyBase Genes
category     = Genes
citation     = Annotated gene models from FlyBase Release R5.4; Nov 2007. 

[Genes:150000]
glyph        = generic
bump         = 0
maxdepth     = 1
stranded     = 1
label        = 0
description  = 0

[TranslationF]
glyph        = translation
global feature = 1
height       = 20
fgcolor      = purple
start_codons = 0
strand       = +1
arrow_height = 2
translation  = 3frame
category     = Sequence
key          = 3-frame translation (forward)
citation     = This track shows the position of stop codons at low magnifications,
	and the 3-frame translation at high magnifications.  Only the forward strand
	is shown.

[DNA/GC Content]
glyph          = dna
global feature = 1
strand         = both
gc_window      = auto
height         = 40
fgcolor        = red
key            = GC Content
category       = Sequence
citation       = This track show the %GC of the displayed sequence region.  When zoomed in close enough, the DNA sequence is displayed

[TranslationR]
glyph        = translation
global feature = 1
height       = 20
fgcolor      = blue
strand       = -1
start_codons = 0
arrow_height = 2
translation  = 3frame
category     = Sequence
key          = 3-frame translation (reverse)
citation     = This track shows the position of stop codons at low magnifications,
	and the 3-frame translation at high magnifications.  Only the reverse
	strand is shown.

[ETILE1]
feature       = tiling_path:stage01
glyph         = wiggle_xyplot
graph_height  = 9
graph_type    = boxes
scale         = right
fgcolor       = black
#bgcolor       = red
scale_color   = black
category      = Transcription Tiling Arrays (graph)
key           = Affy Graph 00-02 hrs
#smoothing     = max
#smoothing window = 50
citation      = sub { signal_citation() }

[ETILE2]
feature       = tiling_path:stage02
glyph         = wiggle_xyplot
graph_height  = 9
graph_type    = boxes
scale         = right
fgcolor       = black
bgcolor       = red
scale_color   = black
category      = Transcription Tiling Arrays (graph)
key           = Affy Graph 02-04 hrs
#smoothing     = max
#smoothing window = 50
citation      = sub { signal_citation() }

[ETILE3]
feature       = tiling_path:stage03
glyph         = wiggle_xyplot
graph_height  = 9
graph_type    = boxes
scale         = right
fgcolor       = black
bgcolor       = red
scale_color   = black
category      = Transcription Tiling Arrays (graph)
key           = Affy Graph 04-06 hrs
#smoothing     = max
#smoothing window = 50
citation      = sub { signal_citation() }

[ETILE4]
feature       = tiling_path:stage04
glyph         = wiggle_xyplot
graph_height  = 9
graph_type    = boxes
scale         = right
fgcolor       = black
bgcolor       = red
scale_color   = black
category      = Transcription Tiling Arrays (graph)
key           = Affy Graph 06-08 hrs
#smoothing     = max
#smoothing window = 50
citation      = sub { signal_citation() }

[ETILE5]
feature       = tiling_path:stage05
glyph         = wiggle_xyplot
graph_height  = 9
graph_type    = boxes
scale         = right
fgcolor       = black
bgcolor       = red
scale_color   = black
category      = Transcription Tiling Arrays (graph)
key           = Affy Graph 08-10 hrs
#smoothing     = max
#smoothing window = 50
citation      = sub { signal_citation() }

[ETILE6]
feature       = tiling_path:stage06
glyph         = wiggle_xyplot
graph_height  = 9
graph_type    = boxes
scale         = right
fgcolor       = black
bgcolor       = red
scale_color   = black
category      = Transcription Tiling Arrays (graph)
key           = Affy Graph 10-12 hrs
#smoothing     = max
#smoothing window = 50
citation      = sub { signal_citation() }

[ETILE7]
feature       = tiling_path:stage07
glyph         = wiggle_xyplot
graph_height  = 9
graph_type    = boxes
scale         = right
fgcolor       = black
bgcolor       = red
scale_color   = black
category      = Transcription Tiling Arrays (graph)
key           = Affy Graph 12-14 hrs
#smoothing     = max
#smoothing window = 50
citation      = sub { signal_citation() }

[ETILE8]
feature       = tiling_path:stage08
glyph         = wiggle_xyplot
graph_height  = 9
graph_type    = boxes
scale         = right
fgcolor       = black
bgcolor       = red
scale_color   = black
category      = Transcription Tiling Arrays (graph)
key           = Affy Graph 14-16 hrs
#smoothing     = max
#smoothing window = 50
citation      = sub { signal_citation() }

[ETILE9]
feature       = tiling_path:stage09
glyph         = wiggle_xyplot
graph_height  = 9
graph_type    = boxes
scale         = right
fgcolor       = black
bgcolor       = red
scale_color   = black
category      = Transcription Tiling Arrays (graph)
key           = Affy Graph 16-18 hrs
#smoothing     = max
#smoothing window = 50
citation      = sub { signal_citation() }

[ETILE10]
feature       = tiling_path:stage10
glyph         = wiggle_xyplot
graph_height  = 9
graph_type    = boxes
scale         = right
fgcolor       = black
bgcolor       = red
scale_color   = black
category      = Transcription Tiling Arrays (graph)
key           = Affy Graph 18-20 hrs
#smoothing     = max
#smoothing window = 50
citation      = sub { signal_citation() }

[ETILE11]
feature       = tiling_path:stage11
glyph         = wiggle_xyplot
graph_height  = 9
graph_type    = boxes
scale         = right
fgcolor       = black
bgcolor       = red
scale_color   = black
category      = Transcription Tiling Arrays (graph)
key           = Affy Graph 20-22 hrs
#smoothing     = max
#smoothing window = 50
citation      = sub { signal_citation() }

[ETILE12]
feature       = tiling_path:stage12
glyph         = wiggle_xyplot
graph_height  = 9
graph_type    = boxes
scale         = right
fgcolor       = black
bgcolor       = red
scale_color   = black
category      = Transcription Tiling Arrays (graph)
key           = Affy Graph 22-24 hrs
#smoothing     = max
#smoothing window = 50
citation      = sub { signal_citation() }

[EHEATMAP1]
feature       = tiling_path:stage01
glyph         = wiggle_density
fgcolor       = black
bgcolor       = red
category      = Transcription Tiling Arrays (heatmap)
key           = Affy Heatmap 00-02 hrs
#smoothing     = max
citation      = sub { signal_citation() }


[EHEATMAP2]
feature       = tiling_path:stage02
glyph         = wiggle_density
fgcolor       = black
bgcolor       = red
category      = Transcription Tiling Arrays (heatmap)
key           = Affy Heatmap 02-04 hrs
#smoothing     = max
#smoothing window = 50
citation      = sub { signal_citation() }

[EHEATMAP3]
feature       = tiling_path:stage03
glyph         = wiggle_density
fgcolor       = black
bgcolor       = red
category      = Transcription Tiling Arrays (heatmap)
key           = Affy Heatmap 04-06 hrs
#smoothing     = max
#smoothing window = 50
citation      = sub { signal_citation() }

[EHEATMAP4]
feature       = tiling_path:stage04
glyph         = wiggle_density
fgcolor       = black
bgcolor       = red
category      = Transcription Tiling Arrays (heatmap)
key           = Affy Heatmap 06-08 hrs
#smoothing     = max
#smoothing window = 50
citation      = sub { signal_citation() }

[EHEATMAP5]
feature       = tiling_path:stage05
glyph         = wiggle_density
fgcolor       = black
bgcolor       = red
category      = Transcription Tiling Arrays (heatmap)
key           = Affy Heatmap 08-10 hrs
#smoothing     = max
#smoothing window = 50
citation      = sub { signal_citation() }

[EHEATMAP6]
feature       = tiling_path:stage06
glyph         = wiggle_density
fgcolor       = black
bgcolor       = red
category      = Transcription Tiling Arrays (heatmap)
key           = Affy Heatmap 10-12 hrs
#smoothing     = max
#smoothing window = 50
citation      = sub { signal_citation() }

[EHEATMAP7]
feature       = tiling_path:stage07
glyph         = wiggle_density
fgcolor       = black
bgcolor       = red
category      = Transcription Tiling Arrays (heatmap)
key           = Affy Heatmap 12-14 hrs
#smoothing     = max
#smoothing window = 50
citation      = sub { signal_citation() }

[EHEATMAP8]
feature       = tiling_path:stage08
glyph         = wiggle_density
fgcolor       = black
bgcolor       = red
category      = Transcription Tiling Arrays (heatmap)
key           = Affy Heatmap 14-16 hrs
#smoothing     = max
#smoothing window = 50
citation      = sub { signal_citation() }

[EHEATMAP9]
feature       = tiling_path:stage09
glyph         = wiggle_density
fgcolor       = black
bgcolor       = red
category      = Transcription Tiling Arrays (heatmap)
key           = Affy Heatmap 16-18 hrs
#smoothing     = max
#smoothing window = 50
citation      = sub { signal_citation() }

[EHEATMAP10]
feature       = tiling_path:stage10
glyph         = wiggle_density
fgcolor       = black
bgcolor       = red
category      = Transcription Tiling Arrays (heatmap)
key           = Affy Heatmap 18-20 hrs
#smoothing     = max
#smoothing window = 50
citation      = sub { signal_citation() }

[EHEATMAP11]
feature       = tiling_path:stage11
glyph         = wiggle_density
fgcolor       = black
bgcolor       = red
category      = Transcription Tiling Arrays (heatmap)
key           = Affy Heatmap 20-22 hrs
#smoothing     = max
#smoothing window = 50
citation      = sub { signal_citation() }

[EHEATMAP12]
feature       = tiling_path:stage12
glyph         = wiggle_density
fgcolor       = black
bgcolor       = red
category      = Transcription Tiling Arrays (heatmap)
key           = Affy Heatmap 22-24 hrs
#smoothing     = max
#smoothing window = 50
citation      = sub { signal_citation() }

[TRANS1]
feature       = transcribed_region:set00
height        = 6
fgcolor       = black
bgcolor       = lightsteelblue
category      = Transcription Tiling Arrays (transcribed regions)
key           = Affy Transfrags 00-02 hrs
bump          = 0
citation      = sub { transfrag_citation() }

[TRANS2]
feature       = transcribed_region:set02
height        = 6
fgcolor       = black
bgcolor       = lightsteelblue
category      = Transcription Tiling Arrays (transcribed regions)
key           = Affy Transfrags 02-04 hrs
bump          = 0
citation      = sub { transfrag_citation() }

[TRANS3]
feature       = transcribed_region:set04
height        = 6
fgcolor       = black
bgcolor       = lightsteelblue
category      = Transcription Tiling Arrays (transcribed regions)
key           = Affy Transfrags 04-06 hrs
bump          = 0
citation      = sub { transfrag_citation() }

[TRANS4]
feature       = transcribed_region:set06
height        = 6
fgcolor       = black
bgcolor       = lightsteelblue
category      = Transcription Tiling Arrays (transcribed regions)
key           = Affy Transfrags 06-08 hrs
bump          = 0
citation      = sub { transfrag_citation() }

[TRANS5]
feature       = transcribed_region:set08
height        = 6
fgcolor       = black
bgcolor       = lightsteelblue
category      = Transcription Tiling Arrays (transcribed regions)
key           = Affy Transfrags 08-10 hrs
bump          = 0
citation      = sub { transfrag_citation() }

[TRANS6]
feature       = transcribed_region:set10
height        = 6
fgcolor       = black
bgcolor       = lightsteelblue
category      = Transcription Tiling Arrays (transcribed regions)
key           = Affy Transfrags 10-12 hrs
bump          = 0
citation      = sub { transfrag_citation() }

[TRANS7]
feature       = transcribed_region:set12
height        = 6
fgcolor       = black
bgcolor       = lightsteelblue
category      = Transcription Tiling Arrays (transcribed regions)
key           = Affy Transfrags 12-14 hrs
bump          = 0
citation      = sub { transfrag_citation() }

[TRANS8]
feature       = transcribed_region:set14
height        = 6
fgcolor       = black
bgcolor       = lightsteelblue
category      = Transcription Tiling Arrays (transcribed regions)
key           = Affy Transfrags 14-16 hrs
bump          = 0
citation      = sub { transfrag_citation() }

[TRANS9]
feature       = transcribed_region:set16
height        = 6
fgcolor       = black
bgcolor       = lightsteelblue
category      = Transcription Tiling Arrays (transcribed regions)
key           = Affy Transfrags 16-18 hrs
bump          = 0
citation      = sub { transfrag_citation() }

[TRANS10]
feature       = transcribed_region:set18
height        = 6
fgcolor       = black
bgcolor       = lightsteelblue
category      = Transcription Tiling Arrays (transcribed regions)
key           = Affy Transfrags 18-20 hrs
bump          = 0
citation      = sub { transfrag_citation() }

[TRANS11]
feature       = transcribed_region:set20
height        = 6
fgcolor       = black
bgcolor       = lightsteelblue
category      = Transcription Tiling Arrays (transcribed regions)
key           = Affy Transfrags 20-22 hrs
bump          = 0
citation      = sub { transfrag_citation() }

[TRANS12]
feature       = transcribed_region:set22
height        = 6
fgcolor       = black
bgcolor       = lightsteelblue
category      = Transcription Tiling Arrays (transcribed regions)
key           = Affy Transfrags 22-24 hrs
bump          = 0
citation      = sub { transfrag_citation() }


#[AUGUSTUS]
#feature      = match:augustus
#group_pattern = /\:\d+$/
#glyph        = transcript2
#sort_order   = sub ($$) { 
#	     my $n1 = shift->feature->display_name;
#	     my $n2 = shift->feature->display_name;
#	     s/^[^0-9]+// for ($n1,$n2);
#	     return $n1 <=> $n2;
#  }
#category     = Genes
#height       = 12
#bgcolor      = steelblue
#label        = 1
#description  = 1
#label_transcripts =  1
#das category = transcription
#key          = Gene Predictions (AUGUSTUS)

#[AUGUSTUS:150000]
#glyph        = generic
#bump         = 0
#maxdepth     = 1
#stranded     = 1
#label        = 0
#description  = 0

[ESTB:50000]
feature   = match_part

[ESTB:101]
fontcolor     = black
height        = 5

[ESTB]
feature       = match
glyph         = segments
label	      = sub { 
	      my $n = shift->name;
	      $n =~ s/\..+//;	
	      $n;
	      }
category     = Sequence Similarity Tracks
draw_target   = 1
show_mismatch = 1
ragged_start  = 1
height        = 5
bgcolor       = limegreen
fgcolor       = black
connector     = solid
citation      = EST ("expressed sequence tag") Indicated in light green.   D. melanogaster EST sequences submitted to the 
                sequence databases prior to 2003 aligned using sim4 (Florea, et al., 1998, Genome Res. 8:967-74) to Release 
                3 by the BDGP and promoted to Releases 4 and 5 by FlyBase. D. melanogaster EST sequences submitted since 2003
                aligned to Releases 4 and 5 by NCBI and submitted to FlyBase.
