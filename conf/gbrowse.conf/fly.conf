[GENERAL]   
description   = D. melanogaster (FlyBase release R5.4; Nov 2007)
db_adaptor    = Bio::DB::SeqFeature::Store
db_args       = -adaptor DBI::mysql
                -dsn     fly

# web-site config
gbrowse_root = gbrowse
stylesheet  = /css/gbrowse.css
buttons     = images/buttons
js          = js
tmpimages   = tmp
balloon images = /images/balloons

balloon tips        = 1
#drag and drop       = 1
titles are balloons = 1
cache time          = 1  # one hour

plugins     = GFFDumper FastaDumper BatchDumper

quicklink plugins = GFFDumper FastaDumper

# need a little room for postgrid labels
image_padding = 25;
pad_left = 50


# list of tracks to turn on by default
default features = Genes  

# The class of the objects used to establish the reference coordinates.
reference class  =

# examples to show in the introduction
examples = ftz  sos 2L:20396779..20446778  

search attributes = Note

# "automatic" classes to try when an unqualified identifier is given
automatic classes = CDS

image_padding = 60

head   =  <script type="text/javascript" src="/js/modencode.js"></script>

init_code = use CGI ':standard';
	    use GD;
            sub embed_browser {param('embedded')}
            sub get_url {url()}
            sub get_location {
              return param('name') if param('name');
              return param('ref') .':'. param('start') ."..". param('end') if param('ref');
	      return '';
            }
	    sub transfrag_citation {
             my $time = shift || 'the first 24 hours';
	     my $full = $time =~ /first/;
	     my $all = 
             "This track shows the location of sites showing transcription during $time of <i>D. melanogaster</i> development".
             ', measured by a tiling array as described in <a href="http://www.ncbi.nlm.nih.gov/entrez/query.fcgi?db='.
	     'pubmed&cmd=Retrieve&dopt=AbstractPlus&list_uids=16951679&query_hl=1&itool=pubmed_docsum" target="_new">'.
	     'Manak JR, et al. Nature Genet. 2006 Oct;38(10):1151-8.</a> ';
	     $all.=
	     'Fragments can also be in separate tracks for each of the twelve timepoints. '. 
             'See the UCSC Genome Browser site for a <a href="http://genome.ucsc.edu/cgi-bin'.
	     '/hgTrackUi?hgsid=99411936&c=chr2L&g=affyDrosDevTransfrags" target="_new">'.
             'more detailed description</a>.' if $full; 
	     $all;
            }
	    sub signal_citation {
	      my $time = shift || 'the first 24 hours';
	      my $full = $time =~ /first/;
              my $all =
	      "This track shows an estimate of RNA abundance (transcription) during $time of <i>D. melanogaster</i> development".
              ', measured by a tiling array as described in <a href="http://www.ncbi.nlm.nih.gov/entrez/query.fcgi?db='.
              'pubmed&cmd=Retrieve&dopt=AbstractPlus&list_uids=16951679&query_hl=1&itool=pubmed_docsum" target="_new">'.
              'Manak JR, et al. Nature Genet. 2006 Oct;38(10):1151-8.</a> ';
               $all .= 
  	      'Composite signals can also be viewed in separate tracks for each of the twelve timepoints. '.
	      'See the UCSC Genome Browser site for a <a href="http://genome.ucsc.edu/cgi-bin'.
	      '/hgTrackUi?hgsid=99411936&c=chr2L&g=affyDrosDevSignal" target="_new">'.
              'more detailed description</a>.' if $full;
              $all;
	    }

header = sub {
       my $embed = embed_browser();
       my $name  = get_location();
       my $url   = get_url();
       my $retval =  q(<script type="text/javascript">balloon.maxWidth = 350</script>);
       my $logo = $embed ? '' : q(<td valign=top width=150><img src="http://www.modencode.org/img/tlogo_small.png" ).
                                q(width=100 alt="logo" border=0 alt="modENCODE logo"/></td>);
       $retval .= q(<table width=100%><tr>).
                  $logo.
                  q(<td valign=top align=center>).
 		  q(<h1><img src="/img/fly_shadow.png" style="vertical-align:middle">&nbsp;<i>D. melanogaster</i> Genome Browser</h1> ).
                  q(</td></tr></table>).
                  q(<br><a class=header href="http://www.modencode.org">[modENCODE home]</a>&nbsp;).
                  q(<a class=header href="/cgi-bin/gbrowse/worm").
                  q(onmouseover="balloon.showTooltip(event,'Switch to the <i>C. elegans</i> genome browser')">).
                  q([Worm Browser]</a>&nbsp;).
		  qq(<a class=header href="http://www.flybase.org/cgi-bin/gbrowse/dmel");
      
       $retval .=  $name ? qq(?name=$name" ) : q(" );

       $name = $name ? "this region ($name) in " : '';

       $retval .=  qq(onmouseover="balloon.showTooltip(event,'Browse ${name}FlyBase')">[Flybase]&nbsp;).
                 q(<a class=header href="mailto:help@modencode.org?subject=modENCODE Genome Browser (worm)").
                 q(onmouseover="balloon.showTooltip(event,'Get help or request new annotations/feature sets, etc.')">).
                 q([Help/Feedback]</a><br>);
       
       return $retval;
   }

# a footer
footer =
	<br><br>
        <table width="100%">
        <TR>
        <TD align="LEFT" class="databody">
        For the source code for this browser, see the <a href="http://www.gmod.org">
        Generic Model Organism Database Project.</a>  <br>For other questions, send
        mail to <a href="mailto:mckays@cshl.org">mckays@cshl.org</a>.
        </TD>
        </TR>
        </table>
        <hr>


# Various places where you can insert your own HTML -- see configuration docs
html1 = sub {if (embed_browser) {"<input type=hidden name='embedded' value='1'>"}}
html2 =
html3 =
html4 =
html5 =
html6 =

# what image widths to offer
image widths  = 450 500 600 640 800 1024

# default width of detailed view (pixels)
default width = 800

# max and default segment sizes for detailed view
max segment     = 5000000
default segment = 50000

# zoom levels
zoom levels    = 100 200 1000 2000 5000 10000 20000 50000 100000 200000 5000000 1000000

# colors of the overview, detailed map and key
overview bgcolor = lightgrey
detailed bgcolor = lightgoldenrodyellow
key bgcolor      = beige

########################
# Default glyph settings
########################


[TRACK DEFAULTS]
glyph         = generic
height        = 10
bgcolor       = lightgrey
fgcolor       = black
font2color    = blue
label density = 100
bump density  = 500
# where to link to when user clicks in detailed view
link          = AUTO
# general dense feature config
smoothing window = sub { my ($win) = sort {$b<=>$a} int($_[4]->panel->length/400), 50; $win }
smoothing        = mean
max_score        = 10

################## TRACK CONFIGURATION ####################
# the remainder of the sections configure individual tracks
###########################################################

[Genes]
feature      = gene
glyph        = gene
category     = Genes
height       = 8
bgcolor      = blue
label        = sub {
		my $f = shift;
		my $dn = $f->display_name;
		my @aliases = $f->each_tag_value('Alias');
		foreach (@aliases) {
		   return "$dn ($_)" if /^\w+-\d+/;
		}
		return $dn;
	}
description  = sub {
	my $f = shift;
	my @subf = eval{$f->get_SeqFeatures};
	my $note;
	for my $sf (@subf) {
	   next unless $sf->primary_tag =~ /RNA|pseudo/;
	   $note ||= join '; ',$sf->each_tag_value('Note');
	}
        $note;
  }
link         = http://www.flybase.org/cgi-bin/uniq.html?species=Dmel&field=SYN&db=fbgn&context=$name&caller=quicksearch
label_transcripts =  sub { return shift->primary_tag eq 'mRNA' }
das category = transcription
key          = FlyBase Genes
category     = Genes
citation     = Annotated gene models from FlyBase Release R5.4; Nov 2007. 

[Genes:150000]
glyph        = generic
bump         = 0
maxdepth     = 1
stranded     = 1
label        = 0
description  = 0

[TranslationF]
glyph        = translation
global feature = 1
height       = 20
fgcolor      = purple
start_codons = 0
strand       = +1
arrow_height = 2
translation  = 3frame
category     = Sequence
key          = 3-frame translation (forward)
citation     = This track shows the position of stop codons at low magnifications,
	and the 3-frame translation at high magnifications.  Only the forward strand
	is shown.

[DNA/GC Content]
glyph          = dna
global feature = 1
strand         = both
gc_window      = auto
height         = 40
fgcolor        = red
key            = GC Content
category       = Sequence
citation       = This track show the %GC of the displayed sequence region.  When zoomed in close enough, the DNA sequence is displayed

[TranslationR]
glyph        = translation
global feature = 1
height       = 20
fgcolor      = blue
strand       = -1
start_codons = 0
arrow_height = 2
translation  = 3frame
category     = Sequence
key          = 3-frame translation (reverse)
citation     = This track shows the position of stop codons at low magnifications,
	and the 3-frame translation at high magnifications.  Only the reverse
	strand is shown.


[ETILES]
feature       = tiling_path
glyph         = wiggle_density
graph_type    = boxes
scale         = right
fgcolor       = black
bgcolor       = black
scale_color   = black
category      = Expression
label         = sub {
	         my $desc = shift->source;
                 $desc =~ s/stage0?//;
                 $desc -= 1;
                 $desc *= 2;
                 my $t2 = $desc + 2;
                 return "$desc-${t2}hrs";
                }
title          = sub {
                 my $desc = shift->source;
                 $desc =~ s/stage0?//;
                 $desc -= 1;
                 $desc *= 2;
                 my $t2 = $desc + 2;
                 return "Transcription tiling array $desc-${t2}hrs";
                }
label_position = left
description   = 0
key           = Affy Devel Tiling Array
citation      = sub { signal_citation() }
sort_order    = sub ($$) {
	          my $a = shift->feature->source;
		  my $b = shift->feature->source;
		  $a cmp $b;
		}
 

[ETILE1]
feature       = tiling_path:stage01
glyph         = wiggle_density
graph_height  = 9
graph_type    = boxes
scale         = right
fgcolor       = black
bgcolor       = black
scale_color   = black
category      = Transcription Tiling Arrays
key           = Affy Devel 00-02 hrs
citation      = sub { signal_citation('0-2 hours') }

[ETILE2]
feature       = tiling_path:stage02
glyph         = wiggle_density
graph_height  = 9
graph_type    = boxes
scale         = right
fgcolor       = black
bgcolor       = black
scale_color   = black
category      = Transcription Tiling Arrays
key           = Affy Devel 02-04 hrs
citation      = sub { signal_citation('2-4 hours') }

[ETILE3]
feature       = tiling_path:stage03
glyph         = wiggle_density
graph_height  = 9
graph_type    = boxes
scale         = right
fgcolor       = black
bgcolor       = black
scale_color   = black
category      = Transcription Tiling Arrays
key           = Affy Devel 04-06 hrs
citation      = sub { signal_citation('4-6 hours') }

[ETILE4]
feature       = tiling_path:stage04
glyph         = wiggle_density
graph_height  = 9
graph_type    = boxes
scale         = right
fgcolor       = black
bgcolor       = black
scale_color   = black
category      = Transcription Tiling Arrays
key           = Affy Devel 06-08 hrs
citation      = sub { signal_citation('6-8 hours') }

[ETILE5]
feature       = tiling_path:stage05
glyph         = wiggle_density
graph_height  = 9
graph_type    = boxes
scale         = right
fgcolor       = black
bgcolor       = black
scale_color   = black
category      = Transcription Tiling Arrays
key           = Affy Devel 08-10 hrs
citation      = sub { signal_citation('8-10 hours') }

[ETILE6]
feature       = tiling_path:stage06
glyph         = wiggle_density
graph_height  = 9
graph_type    = boxes
scale         = right
fgcolor       = black
bgcolor       = black
scale_color   = black
category      = Transcription Tiling Arrays
key           = Affy Devel 10-12 hrs
citation      = sub { signal_citation('10-12 hours') }

[ETILE7]
feature       = tiling_path:stage07
glyph         = wiggle_density
graph_height  = 9
graph_type    = boxes
scale         = right
fgcolor       = black
bgcolor       = black
scale_color   = black
category      = Transcription Tiling Arrays
key           = Affy Devel 12-14 hrs
citation      = sub { signal_citation('12-14 hours') }

[ETILE8]
feature       = tiling_path:stage08
glyph         = wiggle_density
graph_height  = 9
graph_type    = boxes
scale         = right
fgcolor       = black
bgcolor       = black
scale_color   = black
category      = Transcription Tiling Arrays
key           = Affy Devel 14-16 hrs
citation      = sub { signal_citation('14-16 hours') }

[ETILE9]
feature       = tiling_path:stage09
glyph         = wiggle_density
graph_height  = 9
graph_type    = boxes
scale         = right
fgcolor       = black
bgcolor       = black
scale_color   = black
category      = Transcription Tiling Arrays
key           = Affy Devel 16-18 hrs
citation      = sub { signal_citation('16-18 hours') }

[ETILE10]
feature       = tiling_path:stage10
glyph         = wiggle_density
graph_height  = 9
graph_type    = boxes
scale         = right
fgcolor       = black
bgcolor       = black
scale_color   = black
category      = Transcription Tiling Arrays
key           = Affy Devel 18-20 hrs
citation      = sub { signal_citation('18-20 hours') }

[ETILE11]
feature       = tiling_path:stage11
glyph         = wiggle_density
graph_height  = 9
graph_type    = boxes
scale         = right
fgcolor       = black
bgcolor       = black
scale_color   = black
category      = Transcription Tiling Arrays
key           = Affy Devel 20-22 hrs
citation      = sub { signal_citation('20-22 hours') }

[ETILE12]
feature       = tiling_path:stage12
glyph         = wiggle_density
graph_height  = 9
graph_type    = boxes
scale         = right
fgcolor       = black
bgcolor       = black
scale_color   = black
category      = Transcription Tiling Arrays
key           = Affy Devel 22-24 hrs
citation      = sub { signal_citation('22-24 hours') }

[TRANS1]
feature       = transcribed_region:set00
height        = 6
fgcolor       = black
bgcolor       = lightsteelblue
category      = Transcription Tiling Arrays (transcribed regions)
key           = Affy Transfrags 00-02 hrs
bump          = 0
citation      = sub { transfrag_citation('0-2 hours') }

[TRANS2]
feature       = transcribed_region:set02
height        = 6
fgcolor       = black
bgcolor       = lightsteelblue
category      = Transcription Tiling Arrays (transcribed regions)
key           = Affy Transfrags 02-04 hrs
bump          = 0
citation      = sub { transfrag_citation('2-4 hours') }

[TRANS3]
feature       = transcribed_region:set04
height        = 6
fgcolor       = black
bgcolor       = lightsteelblue
category      = Transcription Tiling Arrays (transcribed regions)
key           = Affy Transfrags 04-06 hrs
bump          = 0
citation      = sub { transfrag_citation('4-6 hours') }

[TRANS4]
feature       = transcribed_region:set06
height        = 6
fgcolor       = black
bgcolor       = lightsteelblue
category      = Transcription Tiling Arrays (transcribed regions)
key           = Affy Transfrags 06-08 hrs
bump          = 0
citation      = sub { transfrag_citation('6-8 hours') }

[TRANS5]
feature       = transcribed_region:set08
height        = 6
fgcolor       = black
bgcolor       = lightsteelblue
category      = Transcription Tiling Arrays (transcribed regions)
key           = Affy Transfrags 08-10 hrs
bump          = 0
citation      = sub { transfrag_citation('8-10 hours') }

[TRANS6]
feature       = transcribed_region:set10
height        = 6
fgcolor       = black
bgcolor       = lightsteelblue
category      = Transcription Tiling Arrays (transcribed regions)
key           = Affy Transfrags 10-12 hrs
bump          = 0
citation      = sub { transfrag_citation('10-12 hours') }

[TRANS7]
feature       = transcribed_region:set12
height        = 6
fgcolor       = black
bgcolor       = lightsteelblue
category      = Transcription Tiling Arrays (transcribed regions)
key           = Affy Transfrags 12-14 hrs
bump          = 0
citation      = sub { transfrag_citation('12-14 hours') }

[TRANS8]
feature       = transcribed_region:set14
height        = 6
fgcolor       = black
bgcolor       = lightsteelblue
category      = Transcription Tiling Arrays (transcribed regions)
key           = Affy Transfrags 14-16 hrs
bump          = 0
citation      = sub { transfrag_citation('14-16 hours') }

[TRANS9]
feature       = transcribed_region:set16
height        = 6
fgcolor       = black
bgcolor       = lightsteelblue
category      = Transcription Tiling Arrays (transcribed regions)
key           = Affy Transfrags 16-18 hrs
bump          = 0
citation      = sub { transfrag_citation('16-18 hours') }

[TRANS10]
feature       = transcribed_region:set18
height        = 6
fgcolor       = black
bgcolor       = lightsteelblue
category      = Transcription Tiling Arrays (transcribed regions)
key           = Affy Transfrags 18-20 hrs
bump          = 0
citation      = sub { transfrag_citation('18-20 hours') }

[TRANS11]
feature       = transcribed_region:set20
height        = 6
fgcolor       = black
bgcolor       = lightsteelblue
category      = Transcription Tiling Arrays (transcribed regions)
key           = Affy Transfrags 20-22 hrs
bump          = 0
citation      = sub { transfrag_citation('20-22 hours') }

[TRANS12]
feature       = transcribed_region:set22
height        = 6
fgcolor       = black
bgcolor       = lightsteelblue
category      = Transcription Tiling Arrays (transcribed regions)
key           = Affy Transfrags 22-24 hrs
bump          = 0
citation      = sub { transfrag_citation('22-24 hours') }

[TRANSFRAGS]
feature       = transcribed_region
height        = 6
fgcolor       = black
bgcolor       = lightsteelblue
category      = Expression
key           = Affy Transfrags 0-24 hrs
bump          = 0
sort_order    = sub ($$) {
                  my $a = shift->feature->source;
                  my $b = shift->feature->source;
                  $a cmp $b;
                }
description   = sub { 
	      	  my $src = shift->source;
		  $src =~ s/set0?//;
		  my $t2 = $src + 2;
		  "$src-$t2 hours";
                }
citation      = sub { transfrag_citation() }
bump          = 1

[EST:100000]
feature   = match_part

[EST:101]
fontcolor     = black
height        = 5

[EST]
feature       = match
glyph         = segments
labels        = 1
label	      = sub { 
	         my $n = shift->name;
	         $n =~ s/\..+//;	
	         $n;
	       }
category      = Expression
draw_target   = 1
show_mismatch = 1
ragged_start  = 1
height        = 5
bgcolor       = limegreen
fgcolor       = black
connector     = solid
key           = EST (all)
citation      = EST ("expressed sequence tags") indicated in light green.   <i>D. melanogaster</i> EST sequences submitted to the 
                sequence databases prior to 2003 aligned using sim4 (Florea, et al., 1998, Genome Res. 8:967-74) to Release 
                3 by the BDGP and promoted to Releases 4 and 5 by FlyBase. D. melanogaster EST sequences submitted since 2003
                aligned to Releases 4 and 5 by NCBI and submitted to FlyBase.

[ESTSPLICED:100000]
bump          = 0
label         = 0


[ESTSPLICED]
feature       = match
glyph         = segments
labels        = 1
label         = sub {
                 my $n = shift->name;
                 $n =~ s/\..+//;
                 $n;
               }
filter        = sub {
                  shift->segments > 1;                                                                                                                                                                          
               }
category      = Expression
draw_target   = 1
show_mismatch = 1
ragged_start  = 1
height        = 5
bgcolor       = limegreen
fgcolor       = black
connector     = solid
key           = EST (spliced)
citation      = EST ("expressed sequence tags") that span an intron are indicated in light green.   <i>D. melanogaster</i> EST sequences submitted to the
                sequence databases prior to 2003 aligned using sim4 (Florea, et al., 1998, Genome Res. 8:967-74) to Release
                3 by the BDGP and promoted to Releases 4 and 5 by FlyBase. D. melanogaster EST sequences submitted since 2003
                aligned to Releases 4 and 5 by NCBI and submitted to FlyBase.
