[GENERAL]
description   = C. elegans (WormBase release WS176)
#db_adaptor    = Bio::DB::SeqFeature::Store
#db_args       = -adaptor DBI::mysql
#                -dsn     worm
db_adapter    = Bio::DB::GFF
db_args       = -dsn dbi:mysql:worm;user=nobody

aggregators = 
aggregators = alignment
              wormbase_gene{coding_exon,five_prime_UTR,three_prime_UTR}
              candidate_gene{CDS}
              RNA{exon/Transcript}
              ost{expressed_sequence_match}
              pseudo{exon:Pseudogene/Pseudogene}

# Web site configuration info
gbrowse_root = gbrowse
stylesheet  = /css/gbrowse.css
buttons     = images/buttons
js          = js
tmpimages   = tmp
balloon images = /images/balloons
balloon tips = 1
drag and drop = 0

plugins     = GFFDumper FastaDumper BatchDumper

quicklink plugins = GFFDumper FastaDumper

# list of tracks to turn on by default
default features = Genes OSTB ESTB

# The class of the objects used to establish the reference coordinates.
reference class  =

# examples to show in the introduction
examples = I:110643..112642 V:625000..675000

search attributes = Note

# "automatic" classes to try when an unqualified identifier is given
automatic classes = Sequence CDS

image_padding = 80
pad_right  = 25

head   =  <script type="text/javascript" src="/js/modencode.js"></script>

init_code = use CGI ':standard';
            sub embed_browser {param('embedded')}
	    sub get_url {url()}
	    sub get_location {
	      return param('name') if param('name');
	      return param('ref') .':'. param('start') ."..". param('end') if param('ref');
	      return '';
            }

header = sub { 
       my $embed = embed_browser();
       my $name  = get_location();
       my $url   = get_url();
       my $retval =  q(<script type="text/javascript">balloon.maxWidth = 300</script>);
       my $logo = $embed ? '' : q(<td valign=top width=150><img src="http://www.modencode.org/img/tlogo_small.png" ).
                                q(width=100 alt="logo" border=0 alt="modENCODE logo"/></td>);
       $retval .= q(<table width=100%><tr>).
                  $logo.
                  q(<td valign=top align=center>).
                  q(<h1><img src="/img/celegans_base.png" style="vertical-align:middle">&nbsp;<i>C. elegans</i> Genome Browser</h1> ).
                  q(</td></tr></table>);
       if ($embed) {
       $retval .= qq(<a class=header href="$url?name=$name" target="_new").
                  q(onmouseover="balloon.showTooltip(event,'Run the genome browser in a new window')">).	
                  q([Expand Genome Browser]</a>&nbsp;).
                  q(<a class=header href="http://www.modencode.org/karyotypes.html" ).
                  q(onmouseover="balloon.showTooltip(event,'Go to the karyotype view to select a new chromosome or genome')">).
                  q([Whole Genome View]</a>&nbsp;).
                  q(<a class=header href="/cgi-bin/gbrowse/fly?embedded=1").
                  q(onmouseover="balloon.showTooltip(event,'Switch to the <i>D. melanogaster</i> genome browser')">).
                  q([Fly Browser]</a>&nbsp;);
     }
     else {
      $retval .= q(<br><a class=header href="http://www.modencode.org">[modENCODE home]</a>&nbsp;).
                 q(<a class=header href="/cgi-bin/gbrowse/fly").
                 q(onmouseover="balloon.showTooltip(event,'Switch to the <i>D. melanogaster</i> genome browser')">).
                 q([Fly Browser]</a>&nbsp;);
     }

     $retval .=  q(<a class=header href="http://www.wormbase.org/db/seq/gbrowse/elegans");
     $retval .=  $name ? qq(?name=$name" ) : q(" );
 
     $name = $name ? "this region ($name) in " : '';

     $retval .=  qq(onmouseover="balloon.showTooltip(event,'Browse ${name}wormbase')">[Wormbase]&nbsp;).
                 q(<a class=header href="mailto:help@modencode.org?subject=modENCODE Genome Browser (worm)").
                 q(onmouseover="balloon.showTooltip(event,'Get help or request new annotations/feature sets, etc.')">&nbsp;).
                 q([Help/Feedback]</a><br>);
     return $retval;
  }

# a footer
footer =
        <br>
        <table width="100%">
        <TR>
        <TD align="LEFT" class="databody">
        For the source code for this browser, see the <a href="http://www.gmod.org">
        Generic Model Organism Database Project.</a>  <br>For other questions, send
        mail to <a href="mailto:mckays@cshl.org">mckays@cshl.org</a>.
        </TD>
        </TR>
        </table>
        <hr>


# Various places where you can insert your own HTML -- see configuration docs
html1 =  sub {if (embed_browser) {"<input type=hidden name='embedded' value='1'>"}}
html2 =
html3 =
html4 =
html5 =
html6 =

# what image widths to offer
image widths  = 450 500 600 640 800 1024

# default width of detailed view (pixels)
default width = 800

# max and default segment sizes for detailed view
max segment     = 5000000
default segment = 5000

# zoom levels
zoom levels    = 100 200 1000 2000 5000 10000 20000 50000 100000 200000 5000000 1000000

# colors of the overview, detailed map and key
overview bgcolor = lightgrey
detailed bgcolor = lightgoldenrodyellow
key bgcolor      = beige

########################
# Default glyph settings
########################

[TRACK DEFAULTS]
glyph         = generic
height        = 10
bgcolor       = lightgrey
fgcolor       = black
font2color    = blue
label density = 100
bump density  = 500
# where to link to when user clicks in detailed view
link          = AUTO
smoothing window = sub { my ($win) = sort {$b<=>$a} int($_[4]->panel->length/400), 50; $win }
smoothing        = mean
clip          = 1
max_score     = 100

################## TRACK CONFIGURATION ####################
# the remainder of the sections configure individual tracks
###########################################################
[Genes]
feature       = wormbase_gene:Coding_transcript RNA pseudo
                RNAz:ncRNA
glyph        = sub {shift->primary_tag eq 'pseudo' ? 'wormbase_transcript' : 'full_transcript'}
forwardcolor = violet
reversecolor = cyan
utr_color    = gray
category     = Genes
height       = 8
label        = sub {
		my $f = shift;
		my $dn = $f->display_name;
		my @aliases = $f->each_tag_value('Alias');
		foreach (@aliases) {
		   return "$dn ($_)" if /^\w+-\d+/;
		}
		return $dn;
	}
description  = sub {
	my $f = shift;
	my @subf = $f->get_SeqFeatures('mRNA');
	my $note;
	for my $sf (@subf) {
	   $note ||= join '; ',$sf->each_tag_value('Note');
	}
        $note;
  }
link         = http://www.wormbase.org/db/get?name=$name;class=Gene
label_transcripts =  1
das category = transcription
key          = Curated WormBase Genes
citation     = These are gene predictions that have been reviewed by WormBase curators.  The
	     purple and blue colors indicate CDS regions on the forward and
	     reverse strands respectively.  The grey areas represent 5' and
	     3' ESTs assigned automatically using the extents of
	     overlapping ESTs and full-length cDNAs.  The UTR predictions
	     have <b>not</b> been reviewed by WormBase curators, and are
	     known to contain artifacts. If sufficient room is available
	     between features, gene models end with a triangle; if not a
	     small arrow is used.  The tRNAs are predicted by Sean Eddy&#146;s
	     tRNAscan program, and miRNA transcripts taken from a variety
	     of literature sources. RNAz-derived ncRNAs were predicted using
             the <a href="http://www.tbi.univie.ac.at/~wash/RNAz/">RNAz algorithm</a>.
             Please select the RNA for more details.

[Genes:150000]
glyph        = generic
bump         = 0
maxdepth     = 1
stranded     = 1
label        = 0
description  = 0

[AUGUSTUS]
feature      = candidate_gene:AUGUSTUS
glyph        = full_transcript
forwardcolor = violet
reversecolor = cyan
utr_color    = gray
category     = Genes
height       = 8
bgcolor      = blue
label        = 1
description  = 1
label_transcripts =  1
das category = transcription
key          = Gene Predictions (AUGUSTUS)
link         = 0
citation     = <i>Ab initio</i> gene predictions from AUGUSTUS.  AUGUSTUS was one of the highest scoring
               <i>Ab initio</i> competitors in the nGASP gene prediction evaluation.  
	       <ul>
	       <li> <a target="_new"
               href="http://augustus.gobics.de/predictions/caenorhabditis/">More information about the predictions...</a>
	       <li> <a terget="_new"
	       href="http://www.wormbase.org/wiki/index.php/NGASP">More information about nGASP...</a>
	       </ul>

[AUGUSTUS:150000]
glyph        = generic
bump         = 0
maxdepth     = 1
stranded     = 1
label        = 0
description  = 0


[TranslationF]
glyph        = translation
global feature = 1
height       = 20
fgcolor      = purple
start_codons = 0
strand       = +1
arrow_height = 2
translation  = 3frame
category     = Sequence
key          = 3-frame translation (forward)
citation     = This track shows the position of stop codons at low magnifications,
	and the 3-frame translation at high magnifications.  Only the forward strand
	is shown.

[DNA/GC Content]
glyph          = dna
global feature = 1
strand         = both
gc_window      = auto
height         = 40
fgcolor        = red
key            = GC Content
category       = Sequence

[TranslationR]
glyph        = translation
global feature = 1
height       = 20
fgcolor      = blue
strand       = -1
start_codons = 0
arrow_height = 2
translation  = 3frame
category     = Sequence
key          = 3-frame translation (reverse)
citation     = This track shows the position of stop codons at low magnifications,
	and the 3-frame translation at high magnifications.  Only the reverse
	strand is shown.


[OST]
feature       = ost:BLAT_OST_BEST
glyph         = segments
category      = Expression
draw_target   = 1
show_mismatch = 1
ragged_start  = 1
height        = 5
bgcolor       = black
fgcolor       = black
connector     = solid
group_pattern = /^OST[RF]/
link          = sub {
                        my $feature = shift;
                        my $name = $feature->name;
                        $name =~ s/^OST[FR](10|30)/$1/;
                        $name =~ s/^OST[FR]/10/;
                        $name =~ s/_\d*//;
                        $name =~ s/([A-Z]+\d+)$/\@$1/;
                        return qq[http://worfdb.dfci.harvard.edu/searchallwormorfs.pl?by=plate&sid=$name];
                        }
label = 1
link_target   = _blank
key           = ORFeome sequence tags
citation      = These are <a href="http://worfdb.dfci.harvard.edu/">ORFeome project</a> sequence reads.
        The ORFeome project designs primer assays for spliced mRNAs and then performs sequence reads
        on rtPCR material, producing "OSTs."  This track shows ORFeome project OSTs aligned to the
        <i>C. elegans</i> genome using Jim Kent's BLAT program
        [<a href="http://genome.cse.ucsc.edu/cgi-bin/hgBlat">http://genome.cse.ucsc.edu/cgi-bin/hgBlat</a>].
        This track shows the best unique location for each OST.  Blue boxes
        show RST sequences from 5' and 3' RACE experiments using SL1/and SL2 as the 5' universal primer (Kourosh
        Salehi-Ashtiani, Vidal Lab).

[OSTB:50000]
feature   = expressed_sequence_match:BLAT_OST_BEST

[0STB:101]
fontcolor     = black
height        = 5

[ESTBSPLICED:100000]
label        = 0
desciption   = 0 

[ESTB:50000]
feature   = EST_match:BLAT_EST_BEST

[ESTB:101]
fontcolor     = black
height        = 5

[ESTB]
feature       = alignment:BLAT_EST_BEST
glyph         = segments
sort_order    = name
category      = Expression
draw_target   = 1
show_mismatch = 1
ragged_start  = 1
height        = 5
bgcolor       = limegreen
fgcolor       = black
connector     = solid
group_pattern = /\.[35]$/
key           = ESTs (all)
citation      = These are C. elegans expressed sequence tags (ESTs), that have been aligned to
        the C. elegans genome using Jim Kent&#146;s BLAT program [<a href="http://genome.cse.ucsc.edu/cgi-bin/hgBlat">
        http://genome.cse.ucsc.edu/cgi-bin/hgBlat</a>].
        This track shows the best unique location for each EST.
        The paired 5' and 3' ESTs from the same cDNA clone are connected by a dashed line.

[ESTBSPLICED]
feature       = alignment:BLAT_EST_BEST
glyph         = segments
sort_order    = name
filter        = sub {shift->segments > 1}
category      = Expression
draw_target   = 1
show_mismatch = 1
ragged_start  = 1
height        = 5
bgcolor       = limegreen
fgcolor       = black
connector     = solid
group_pattern = /\.[35]$/
key           = ESTs (spliced)
citation      = The subset of C. elegans expressed sequence tags (ESTs) that span introns, aligned to
        the C. elegans genome using Jim Kent&#146;s BLAT program [<a href="http://genome.cse.ucsc.edu/cgi-bin/hgBlat">
        http://genome.cse.ucsc.edu/cgi-bin/hgBlat</a>].
        This track shows the best unique location for each EST.  
        The paired 5' and 3' ESTs from the same cDNA clone are connected by a dashed line.



[SNPs]
feature      = SNP:Allele
category      = Variation Tracks
label        = 0
glyph        = sub {
                my $f = shift;
                # Some SNPs come out length 3. Dunno why.
                return 'diamond'  if $f->length <= 3;
                return 'generic';
        }
bgcolor      = sub {
                my $f = shift;
                my $description = ($f->name =~ /^snp_/ || $f->name =~ /^uCE/) ? 'predicted' : 'verified';
                return $description eq 'verified' ? 'green' : 'yellow';
        }
fgcolor      = black
font2color   = blue
height       = 8
description  = sub {
                my $f = shift;
                my $description = ($f->name =~ /^snp_/ || $f->name =~ /^uCE/) ? 'predicted' : 'verified';
                return "SNP ($description)";
        }
key          = SNPs
citation     = This track shows confirmed and predicted single nucleotide polymorphisms (SNPs).
               Confirmed SNPs that generate an RFLP (a Snip-SNP) are shown in green. Confirmed SNPs
               sequence-detectable SNPs are shown in yellow, and predicted SNPs are shown in red.

[ETILE]
feature       = tiling_path
description   = 0
sort_order    = sub ($$) {
	          my $a = shift->feature->source;
		  my $b = shift->feature->source;
	          return -1 if $a =~ /stage_poly/;
		  return 1  if $b =~ /stage_poly/; 
		  return 0;
                }
glyph         = wiggle_density
height        = 10
graph_type    = boxes
fgcolor       = red
bgcolor       = black
category      = Expression
key           = Transciption tiling arrays
balloon hover = Affymetrix tiling array data from Wang et al. (2007) <b>Mapping the <i>C. elegans</i> noncoding transcriptome with a whole-genome tiling microarray</b> 
label         = sub {
                 my $feature = shift;
                 my $desc = $feature->source;
                 $desc =~ s/adenylated/A/;
                 $desc =~ s/mixed_stage_//;
                 $desc =~ s/small.+/small RNA/;
		 $desc;
 }
label_position = left
citation      = <b>Life_stage</b>  mixed stage<br>
 <b>Strain</b>  N2<br>
 <b>Remark</b>  The data were analyzed with Affymetrix Tiling analysis software (version 1.0.15). Frequency is a log2(max(PM-MM,1))
 value for each probe, after quantile-normalization and median intensity scaling for
 all replicates. See <a href="http://www.ncbi.nlm.nih.gov/sites/entrez?db=pubmed&cmd=retrieve&dopt=AbstractPlus&list_uids=17785534"
 target="_new" title="Mapping the C. elegans noncoding transcriptome with a whole-genome tiling microarray">
 Wang et al., 2007</a> for details.



